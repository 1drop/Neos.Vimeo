{"version":3,"sources":["onedrop.vimeo-grid.js"],"names":["arrayIncludes","array","value","indexOf","toArray","thing","Array","prototype","slice","call","sortByDate","element","getAttribute","sortVideoItemsByDate","sort","a","b","Date","releaseTime","openVideoInLightbox","url","popup","document","createElement","overlay","videoContainer","videoFrame","setAttribute","addEventListener","removeEventListener","this","classList","remove","setTimeout","body","removeChild","appendChild","add","createVideoElementFromObject","obj","el","img","img2","title","window","onedropVimeoGridData","itemClasses","JSON","stringify","albums","link","thumbnail","width","height","textContent","e","preventDefault","substr","href","lastIndexOf","addVideoItems","count","itemsToAdd","currentVideoItemCount","items","length","i","shuffleItemsContainer","push","shuffleLoadMoreButton","Shuffle","shuffle","Viewport","querySelector","OnedropVimeoGrid","querySelectorAll","easing","itemSelector","reverse","by","filters","_bindEventListeners","_onAlbumChange","_handleAlbumChange","bind","forEach","button","_getCurrentAlbumFilters","filter","contains","map","evt","currentTarget","btn","hasActiveFilters","itemPassesFilters","ALL_ITEMS","Object","keys","some","key","filteredAlbums","itemAlbums","parse","hasFilteredAlbum","ID","onedropVimeoGrid","newElements"],"mappings":"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","file":"main.js","sourcesContent":["var Shuffle = window.shuffle;\nvar Viewport = window.Viewport;\nvar shuffleItemsContainer = document.querySelector('#vimeo-grid');\nvar shuffleLoadMoreButton = document.querySelector('#loadmore');\nvar currentVideoItemCount = 0;\n\n// ES7 will have Array.prototype.includes.\nfunction arrayIncludes(array, value) {\n    return array.indexOf(value) !== -1;\n}\n\n// Convert an array-like object to a real array.\nfunction toArray(thing) {\n    return Array.prototype.slice.call(thing);\n}\n\nfunction sortByDate(element) {\n    return element.getAttribute('data-release');\n}\n\nvar OnedropVimeoGrid = function (element) {\n    this.albums = toArray(document.querySelectorAll('#vimeo-filters button'));\n\n    this.shuffle = new Shuffle(element, {\n        easing: 'cubic-bezier(0.165, 0.840, 0.440, 1.000)', // easeOutQuart\n        itemSelector: '.item'\n    });\n\n    this.shuffle.sort({\n        reverse: true,\n        by: sortByDate\n    });\n\n    this.filters = {\n        albums: []\n    };\n\n    this._bindEventListeners();\n};\n\n/**\n * Bind event listeners for when the filters change.\n */\nOnedropVimeoGrid.prototype._bindEventListeners = function () {\n    this._onAlbumChange = this._handleAlbumChange.bind(this);\n\n    this.albums.forEach(function (button) {\n        button.addEventListener('click', this._onAlbumChange);\n    }, this);\n};\n\n/**\n * Get the values of each `active` button.\n * @return {Array.<string>}\n */\nOnedropVimeoGrid.prototype._getCurrentAlbumFilters = function () {\n    return this.albums.filter(function (button) {\n        return button.classList.contains('active');\n    }).map(function (button) {\n        return button.getAttribute('data-value');\n    });\n};\n\n/**\n * A album button was clicked. Update filters and display.\n * @param {Event} evt Click event object.\n */\nOnedropVimeoGrid.prototype._handleAlbumChange = function (evt) {\n    var button = evt.currentTarget;\n\n    // Treat these buttons like radio buttons where only 1 can be selected.\n    if (button.classList.contains('active')) {\n        button.classList.remove('active');\n    } else {\n        this.albums.forEach(function (btn) {\n            btn.classList.remove('active');\n        });\n\n        if (button.getAttribute('data-filter') !== '*') {\n            button.classList.add('active');\n        }\n    }\n\n    this.filters.albums = this._getCurrentAlbumFilters();\n    this.filter();\n\n    // load all videos upon activating a filter\n    this.shuffle.add(addVideoItems('all'));\n};\n\n/**\n * Filter shuffle based on the current state of filters.\n */\nOnedropVimeoGrid.prototype.filter = function () {\n    if (this.hasActiveFilters()) {\n        this.shuffle.filter(this.itemPassesFilters.bind(this));\n    } else {\n        this.shuffle.filter(Shuffle.ALL_ITEMS);\n    }\n};\n\n/**\n * If any of the arrays in the `filters` property have a length of more than zero,\n * that means there is an active filter.\n * @return {boolean}\n */\nOnedropVimeoGrid.prototype.hasActiveFilters = function () {\n    return Object.keys(this.filters).some(function (key) {\n        return this.filters[key].length > 0;\n    }, this);\n};\n\n/**\n * Determine whether an element passes the current filters.\n * @param {Element} element Element to test.\n * @return {boolean} Whether it satisfies all current filters.\n */\nOnedropVimeoGrid.prototype.itemPassesFilters = function (element) {\n    var filteredAlbums = this.filters.albums;\n    var itemAlbums = JSON.parse(element.getAttribute('data-album'));\n\n    if (filteredAlbums[0] != null && filteredAlbums.length > 0) {\n        var hasFilteredAlbum = false;\n        for (var i = 0; i < itemAlbums.length; i++) {\n            if (arrayIncludes(filteredAlbums, itemAlbums[i].ID)) {\n                hasFilteredAlbum = true;\n            }\n        }\n        return hasFilteredAlbum;\n    }\n    return true;\n};\n\nfunction sortVideoItemsByDate(array) {\n    array.sort(function (a, b) {\n        // Turn your strings into dates, and then subtract them\n        // to get a value that is either negative, positive, or zero.\n        return new Date(b.releaseTime) - new Date(a.releaseTime);\n    });\n    return array;\n}\n\nfunction openVideoInLightbox(url) {\n    var popup = document.createElement(\"div\");\n    var overlay = document.createElement(\"div\");\n    var videoContainer = document.createElement(\"div\");\n    var videoFrame = document.createElement(\"iframe\");\n\n    popup.setAttribute(\"id\", \"vimeo-video-popup\");\n    overlay.setAttribute(\"id\", \"vimeo-video-popup__overlay\");\n    videoContainer.setAttribute(\"class\", \"embed-responsive embed-responsive-16by9\");\n    videoFrame.setAttribute(\"src\", url);\n    videoFrame.setAttribute(\"frameborder\", 0);\n    videoFrame.setAttribute(\"webkitallowfullscreen\", '');\n    videoFrame.setAttribute(\"mozallowfullscreen\", '');\n    videoFrame.setAttribute(\"allowfullscreen\", '');\n\n    overlay.addEventListener('click', function () {\n        overlay.removeEventListener('click', this);\n\n        popup.classList.remove('open');\n\n        setTimeout(function () {\n            document.body.removeChild(popup);\n        }, 333);\n    });\n\n    videoContainer.appendChild(videoFrame);\n    popup.appendChild(overlay);\n    popup.appendChild(videoContainer);\n    document.body.appendChild(popup);\n\n    setTimeout(function () {\n        popup.classList.add('open');\n    }, 50);\n}\n\nfunction createVideoElementFromObject(obj) {\n    var el = document.createElement(\"div\");\n    var a = document.createElement(\"a\");\n    var img = document.createElement(\"img\");\n    var img2 = document.createElement(\"img\");\n    var overlay = document.createElement(\"div\");\n    var title = document.createElement(\"span\");\n\n    el.setAttribute(\"class\", window.window.onedropVimeoGridData.itemClasses);\n    el.setAttribute(\"data-album\", JSON.stringify(obj.albums));\n    el.setAttribute(\"data-release\", obj.releaseTime);\n    el.setAttribute(\"data-title\", obj.title);\n    a.setAttribute(\"href\", obj.link);\n    a.setAttribute(\"class\", \"item__inner embed-responsive embed-responsive-16by9\");\n    img.setAttribute(\"src\", obj.thumbnail.link);\n    img.setAttribute(\"width\", obj.thumbnail.width);\n    img.setAttribute(\"height\", obj.thumbnail.height);\n    img.setAttribute(\"alt\", obj.title);\n    img.setAttribute(\"class\", \"embed-responsive-item\");\n    img2.setAttribute(\"src\", obj.thumbnail.link);\n    img2.setAttribute(\"width\", obj.thumbnail.width);\n    img2.setAttribute(\"height\", obj.thumbnail.height);\n    img2.setAttribute(\"alt\", obj.title);\n    img2.setAttribute(\"class\", \"embed-responsive-item hover-effect\");\n    overlay.setAttribute(\"class\", \"item-overlay\");\n    title.setAttribute(\"class\", \"title\");\n    title.textContent = obj.title;\n\n    a.addEventListener('click', function (e) {\n        e.preventDefault();\n        openVideoInLightbox('//player.vimeo.com/video/' + obj.link.substr(this.href.lastIndexOf('/') + 1));\n    });\n\n    overlay.appendChild(title);\n    a.appendChild(img);\n    a.appendChild(img2);\n    a.appendChild(overlay);\n    el.appendChild(a);\n\n    return el;\n}\n\nfunction addVideoItems(count) {\n    var itemsToAdd = [];\n\n    // exit early if all videos are loaded\n    if (currentVideoItemCount >= window.window.onedropVimeoGridData.items.length) {\n        return [];\n    }\n\n    if (count === 'all') {\n        count = window.window.onedropVimeoGridData.items.length;\n    }\n\n    for (var i = 0; i < count; i++) {\n        if (window.window.onedropVimeoGridData.items.length > currentVideoItemCount + i) {\n            var el = createVideoElementFromObject(window.window.onedropVimeoGridData.items[currentVideoItemCount + i]);\n            shuffleItemsContainer.appendChild(el);\n            itemsToAdd.push(el);\n        } else {\n            shuffleLoadMoreButton.classList.add('disabled');\n        }\n    }\n    currentVideoItemCount += itemsToAdd.length;\n    return itemsToAdd;\n}\n\n// sort items by date\nwindow.window.onedropVimeoGridData.items = sortVideoItemsByDate(window.window.onedropVimeoGridData.items);\n\n// add 9 items to dom\naddVideoItems(9);\n\n// initialize shufflejs\nwindow.onedropVimeoGrid = new OnedropVimeoGrid(shuffleItemsContainer);\n\n// load more items on click\nshuffleLoadMoreButton.addEventListener('click', function (e) {\n    e.preventDefault();\n    var newElements = addVideoItems(9);\n    window.onedropVimeoGrid.shuffle.add(newElements);\n});\n"]}