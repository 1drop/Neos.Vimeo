{"version":3,"sources":["onedrop.vimeo-grid.js"],"names":["arrayIncludes","array","value","indexOf","toArray","thing","Array","prototype","slice","call","sortByDate","element","getAttribute","sortVideoItemsByDate","sort","a","b","Date","releaseTime","closeLightBox","popup","overlay","removeEventListener","this","classList","remove","setTimeout","document","body","removeChild","openVideoInLightbox","url","createElement","videoContainer","videoFrame","setAttribute","addEventListener","onkeydown","evt","window","event","isEscape","key","keyCode","appendChild","add","createVideoElementFromObject","obj","el","img","img2","title","onedropVimeoGridData","itemClasses","JSON","stringify","albums","link","thumbnail","width","height","textContent","e","preventDefault","substr","href","lastIndexOf","addVideoItems","count","itemsToAdd","currentVideoItemCount","items","length","i","shuffleItemsContainer","push","shuffleLoadMoreButton","Shuffle","shuffle","Viewport","querySelector","OnedropVimeoGrid","querySelectorAll","easing","itemSelector","reverse","by","filters","_bindEventListeners","_onAlbumChange","_handleAlbumChange","bind","forEach","button","_getCurrentAlbumFilters","filter","contains","map","currentTarget","btn","hasActiveFilters","itemPassesFilters","ALL_ITEMS","Object","keys","some","filteredAlbums","itemAlbums","parse","hasFilteredAlbum","ID","onedropVimeoGrid","newElements"],"mappings":"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","file":"main.js","sourcesContent":["var Shuffle = window.shuffle;\nvar Viewport = window.Viewport;\nvar shuffleItemsContainer = document.querySelector('#vimeo-grid');\nvar shuffleLoadMoreButton = document.querySelector('#loadmore');\nvar currentVideoItemCount = 0;\n\n// ES7 will have Array.prototype.includes.\nfunction arrayIncludes(array, value) {\n    return array.indexOf(value) !== -1;\n}\n\n// Convert an array-like object to a real array.\nfunction toArray(thing) {\n    return Array.prototype.slice.call(thing);\n}\n\nfunction sortByDate(element) {\n    return element.getAttribute('data-release');\n}\n\nvar OnedropVimeoGrid = function (element) {\n    this.albums = toArray(document.querySelectorAll('#vimeo-filters button'));\n\n    this.shuffle = new Shuffle(element, {\n        easing: 'cubic-bezier(0.165, 0.840, 0.440, 1.000)', // easeOutQuart\n        itemSelector: '.item'\n    });\n\n    this.shuffle.sort({\n        reverse: true,\n        by: sortByDate\n    });\n\n    this.filters = {\n        albums: []\n    };\n\n    this._bindEventListeners();\n};\n\n/**\n * Bind event listeners for when the filters change.\n */\nOnedropVimeoGrid.prototype._bindEventListeners = function () {\n    this._onAlbumChange = this._handleAlbumChange.bind(this);\n\n    this.albums.forEach(function (button) {\n        button.addEventListener('click', this._onAlbumChange);\n    }, this);\n};\n\n/**\n * Get the values of each `active` button.\n * @return {Array.<string>}\n */\nOnedropVimeoGrid.prototype._getCurrentAlbumFilters = function () {\n    return this.albums.filter(function (button) {\n        return button.classList.contains('active');\n    }).map(function (button) {\n        return button.getAttribute('data-value');\n    });\n};\n\n/**\n * A album button was clicked. Update filters and display.\n * @param {Event} evt Click event object.\n */\nOnedropVimeoGrid.prototype._handleAlbumChange = function (evt) {\n    var button = evt.currentTarget;\n\n    // Treat these buttons like radio buttons where only 1 can be selected.\n    if (button.classList.contains('active')) {\n        button.classList.remove('active');\n    } else {\n        this.albums.forEach(function (btn) {\n            btn.classList.remove('active');\n        });\n\n        if (button.getAttribute('data-filter') !== '*') {\n            button.classList.add('active');\n        }\n    }\n\n    this.filters.albums = this._getCurrentAlbumFilters();\n    this.filter();\n\n    // load all videos upon activating a filter\n    this.shuffle.add(addVideoItems('all'));\n};\n\n/**\n * Filter shuffle based on the current state of filters.\n */\nOnedropVimeoGrid.prototype.filter = function () {\n    if (this.hasActiveFilters()) {\n        this.shuffle.filter(this.itemPassesFilters.bind(this));\n    } else {\n        this.shuffle.filter(Shuffle.ALL_ITEMS);\n    }\n};\n\n/**\n * If any of the arrays in the `filters` property have a length of more than zero,\n * that means there is an active filter.\n * @return {boolean}\n */\nOnedropVimeoGrid.prototype.hasActiveFilters = function () {\n    return Object.keys(this.filters).some(function (key) {\n        return this.filters[key].length > 0;\n    }, this);\n};\n\n/**\n * Determine whether an element passes the current filters.\n * @param {Element} element Element to test.\n * @return {boolean} Whether it satisfies all current filters.\n */\nOnedropVimeoGrid.prototype.itemPassesFilters = function (element) {\n    var filteredAlbums = this.filters.albums;\n    var itemAlbums = JSON.parse(element.getAttribute('data-album'));\n\n    if (filteredAlbums[0] != null && filteredAlbums.length > 0) {\n        var hasFilteredAlbum = false;\n        for (var i = 0; i < itemAlbums.length; i++) {\n            if (arrayIncludes(filteredAlbums, itemAlbums[i].ID)) {\n                hasFilteredAlbum = true;\n            }\n        }\n        return hasFilteredAlbum;\n    }\n    return true;\n};\n\nfunction sortVideoItemsByDate(array) {\n    array.sort(function (a, b) {\n        // Turn your strings into dates, and then subtract them\n        // to get a value that is either negative, positive, or zero.\n        return new Date(b.releaseTime) - new Date(a.releaseTime);\n    });\n    return array;\n}\n\nfunction closeLightBox(popup, overlay) {\n    overlay.removeEventListener('click', this);\n\n    popup.classList.remove('open');\n\n    setTimeout(function () {\n        document.body.removeChild(popup);\n    }, 333);\n}\n\nfunction openVideoInLightbox(url) {\n    var popup = document.createElement(\"div\");\n    var overlay = document.createElement(\"div\");\n    var videoContainer = document.createElement(\"div\");\n    var videoFrame = document.createElement(\"iframe\");\n\n    popup.setAttribute(\"id\", \"vimeo-video-popup\");\n    overlay.setAttribute(\"id\", \"vimeo-video-popup__overlay\");\n    videoContainer.setAttribute(\"class\", \"embed-responsive embed-responsive-16by9\");\n    videoFrame.setAttribute(\"src\", url);\n    videoFrame.setAttribute(\"frameborder\", 0);\n    videoFrame.setAttribute(\"webkitallowfullscreen\", '');\n    videoFrame.setAttribute(\"mozallowfullscreen\", '');\n    videoFrame.setAttribute(\"allowfullscreen\", '');\n\n    // handle overlay closing via js and ESC key\n    overlay.addEventListener('click', function () {\n        closeLightBox(popup, overlay);\n    });\n    document.onkeydown = function (evt) {\n        evt = evt || window.event;\n        var isEscape = false;\n        if (\"key\" in evt) {\n            isEscape = (evt.key == \"Escape\" || evt.key == \"Esc\");\n        } else {\n            isEscape = (evt.keyCode == 27);\n        }\n        if (isEscape) {\n            closeLightBox(popup, overlay);\n        }\n    };\n\n    videoContainer.appendChild(videoFrame);\n    popup.appendChild(overlay);\n    popup.appendChild(videoContainer);\n    document.body.appendChild(popup);\n\n    setTimeout(function () {\n        popup.classList.add('open');\n    }, 50);\n}\n\nfunction createVideoElementFromObject(obj) {\n    var el = document.createElement(\"div\");\n    var a = document.createElement(\"a\");\n    var img = document.createElement(\"img\");\n    var img2 = document.createElement(\"img\");\n    var overlay = document.createElement(\"div\");\n    var title = document.createElement(\"span\");\n\n    el.setAttribute(\"class\", window.window.onedropVimeoGridData.itemClasses);\n    el.setAttribute(\"data-album\", JSON.stringify(obj.albums));\n    el.setAttribute(\"data-release\", obj.releaseTime);\n    el.setAttribute(\"data-title\", obj.title);\n    a.setAttribute(\"href\", obj.link);\n    a.setAttribute(\"class\", \"item__inner embed-responsive embed-responsive-16by9\");\n    img.setAttribute(\"src\", obj.thumbnail.link);\n    img.setAttribute(\"width\", obj.thumbnail.width);\n    img.setAttribute(\"height\", obj.thumbnail.height);\n    img.setAttribute(\"alt\", obj.title);\n    img.setAttribute(\"class\", \"embed-responsive-item\");\n    img2.setAttribute(\"src\", obj.thumbnail.link);\n    img2.setAttribute(\"width\", obj.thumbnail.width);\n    img2.setAttribute(\"height\", obj.thumbnail.height);\n    img2.setAttribute(\"alt\", obj.title);\n    img2.setAttribute(\"class\", \"embed-responsive-item hover-effect\");\n    overlay.setAttribute(\"class\", \"item-overlay\");\n    title.setAttribute(\"class\", \"title\");\n    title.textContent = obj.title;\n\n    a.addEventListener('click', function (e) {\n        e.preventDefault();\n        openVideoInLightbox('//player.vimeo.com/video/' + obj.link.substr(this.href.lastIndexOf('/') + 1) + '?autoplay=1');\n    });\n\n    overlay.appendChild(title);\n    a.appendChild(img);\n    a.appendChild(img2);\n    a.appendChild(overlay);\n    el.appendChild(a);\n\n    return el;\n}\n\nfunction addVideoItems(count) {\n    var itemsToAdd = [];\n\n    // exit early if all videos are loaded\n    if (currentVideoItemCount >= window.window.onedropVimeoGridData.items.length) {\n        return [];\n    }\n\n    if (count === 'all') {\n        count = window.window.onedropVimeoGridData.items.length;\n    }\n\n    for (var i = 0; i < count; i++) {\n        if (window.window.onedropVimeoGridData.items.length > currentVideoItemCount + i) {\n            var el = createVideoElementFromObject(window.window.onedropVimeoGridData.items[currentVideoItemCount + i]);\n            shuffleItemsContainer.appendChild(el);\n            itemsToAdd.push(el);\n        } else {\n            shuffleLoadMoreButton.classList.add('disabled');\n        }\n    }\n    currentVideoItemCount += itemsToAdd.length;\n    return itemsToAdd;\n}\n\n// sort items by date\nwindow.window.onedropVimeoGridData.items = sortVideoItemsByDate(window.window.onedropVimeoGridData.items);\n\n// add 9 items to dom\naddVideoItems(9);\n\n// initialize shufflejs\nwindow.onedropVimeoGrid = new OnedropVimeoGrid(shuffleItemsContainer);\n\n// load more items on click\nshuffleLoadMoreButton.addEventListener('click', function (e) {\n    e.preventDefault();\n    var newElements = addVideoItems(9);\n    window.onedropVimeoGrid.shuffle.add(newElements);\n});\n"]}